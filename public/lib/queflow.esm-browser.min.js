/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /gh/Dayson9/QueFlowJS@main/queflow.esm-browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
  * QueFlow.js
  * (c) 2024-now Sodiq Tunde (Dayson9)
  * Released under the MIT License.
  */
var counterQF=0,nuggetCounter=0,stylesheet={el:document.createElement("style"),isAppended:!1};const selectElement=e=>document.querySelector("[data-qfid="+e+"]");function qfEvent(e,t){return new CustomEvent(e,{detail:t})}function filterNullElements(e){return e.filter((e=>{if(selectElement(e.qfid))return e}))}function createSignal(e,t){return function e(n){return"object"!=typeof n?n:new Proxy(n,{get:(t,n)=>e(t[n]),set(e,n,r){const s=e[n];e[n]=r;const i=t.host;if(n=parseInt(n)?parseInt(n):n,!i.isFrozen){n>i.data.length-1?(e[n]=r,i.render()):(e[n]=r,updateComponent(n,i,s,r)),i.renderEvent.key=n,i.renderEvent.value=r;const t="string"==typeof i.element?document.getElementById(i.element):i.element;return t&&t.dispatchEvent(i.renderEvent),!0}return!0}})}("object"!=typeof e?{value:e}:e)}const b=e=>stringBetween(e,"{{","}}");function hasChildren(e){return(e.querySelectorAll("*")||0).length>0}function stringBetween(e,t,n){let r="",s=e.indexOf(t)+2,i=e.indexOf(n);return r=e.slice(s,i),r||""}function sanitizeString(e){let t=[{from:"&gt;",to:">"},{from:"&lt;",to:"<"},{from:"<script>",to:"&lt;script&gt;"},{from:"<\/script>",to:"&lt;/script&gt;"}];e=new String(e);for(let{from:n,to:r}of t)e=e.replaceAll(n,r);return e.replace(/javascript:/gi,"")}function evaluateTemplate(e,t){let n="";const r=/\{\{[^\{\{]+\}\}/g;try{n=e.replace(r,(e=>{const n=b(e),r=Function("return "+n).call(t);let s="";return s=[void 0,NaN,null].includes(r)&&"0"!=r?e:r,s}))}catch(e){/Unexpected token/i.test(e)||console.error("QueFlow Error:\nAn error occurred while parsing JSX/HTML:\n\n"+e)}return n}function getAttributes(e){let t,n=[],r=0,s=e.attributes,i=s.length;try{for(r=0;r<i;r++){t=s[r];let e=t.nodeName,i=t.nodeValue.trim();n.push({attribute:e,value:i})}}catch(t){throw new Error("QueFlow Error:\nAn error occurred while getting the attributes of "+e+", "+t)}return n}function jsxToHTML(e,t,n){let r="",s=[],i=(new DOMParser).parseFromString(e,"text/html").body;try{let e=i.querySelectorAll("*"),r=e.length;for(let i=0;i<r;i++){let r=e[i];n&&!r.hasAttribute("data-sub_id")&&(r.dataset.sub_id=n),hasChildren(r)?s.push(...generateComponentData(r,!0,t)):s.push(...generateComponentData(r,!1,t)),r.removeAttribute("innertext")}}catch(e){console.error("QueFlow Error:\nAn error occurred while processing JSX/HTML:\n"+e)}return r=evaluateTemplate(i.innerHTML,t),i.remove(),[r,s]}function isSame(e,t){let n=Object.keys(e),r=Object.keys(t),s=!1;if(n.length!==r.length)s=!1;else for(key of n){if(e[key]!==t[key]){s=!1;break}s=!0}return s}function generateComponentData(e,t,n){let r=[],s=getAttributes(e),i=e.dataset.qfid;const o=e instanceof SVGElement;t||s.push({attribute:n.useStrict?"innerText":"innerHTML",value:n.useStrict?e.innerText:e.innerHTML});for(let{attribute:t,value:l}of s){l=l||"";let s=l.indexOf("{{")>-1&&l.indexOf("}}")>-1;if(!i&&s&&(e.dataset.qfid="qf"+counterQF,i="qf"+counterQF,counterQF++),!e.style[t]&&""!==e.style[t]||o?e.setAttribute(t,evaluateTemplate(l,n)):(e.style[t]=evaluateTemplate(l,n),"src"!==t.toLowerCase()&&e.removeAttribute(t)),s){evaluateTemplate(l,n)!==l&&((e.style[t]||""===e.style[t]&&!o)&&"src"!==t.toLowerCase()||"filter"===t?r.push({template:l,key:"style."+t,qfid:i}):r.push({template:l,key:t,qfid:i}))}}return r}function objToStyle(e="",t={},n="",r){let s="";const i=-1===n.indexOf("@keyframes")&&-1===n.indexOf("@font-face");for(const o in t){const l=t[o],a=o.indexOf("@font-face")>-1;if("string"==typeof l){let t="string"==typeof l||n.indexOf("@media")>-1?e:"";s+=r?`\n${o}${i?t:""} {\n${l}}\n`:`\n${i&&!a?t:""} ${o} {${l}}\n`}else s+=`\n${o} {\n${objToStyle(e,l,o)}\n}`}return s}function initiateStyleSheet(e="",t=Object,n){let r=objToStyle(e,t.stylesheet,"",n);stylesheet.el.textContent+=r,stylesheet.isAppended||document.head.appendChild(stylesheet.el)}function handleEventListener(e,t){const n=e.querySelectorAll("*"),r=n.length;for(let e=0;e<r;e++){let r=n[e],s=getAttributes(r),i=s.length;for(let e=0;e<i;e++){const{attribute:n,value:i}=s[e];if(n.startsWith("on")){const e=r.dataset.sub_id;if(e){const t=Function("return "+e)(),s=Function("e",i).bind(t);r[n]=s}else{const e=Function("e",i).bind(t);r[n]=e}}}r.removeAttribute("data-sub_id")}}function getFirstElement(e){const t=(new DOMParser).parseFromString(e,"text/html").body,n=t.firstElementChild;return n.id||(n.id="qfEl"+counterQF,counterQF++),[n,t.innerHTML]}function update(e,t,n){if(t.indexOf("style.")>-1){let r=t.slice(6);e.style[r]=n}else t.startsWith("on")?e.addEventListener(t.slice(2),n):e.getAttribute(t)?e.setAttribute(t,n):e[t]=n}function needsUpdate(e,t){return!(!e.includes("{{")||!e.includes("}}"))&&(!!b(e).includes(t)||needsUpdate(e.replace("{{"+b(e)+"}}",b(e)),t))}function updateComponent(e,t,n,r){if(n!==r){t.dataQF=filterNullElements(t.dataQF);let{dataQF:n}=t;for(let r of n){let{template:n,key:s,qfid:i}=r,o=selectElement(i);if(needsUpdate(n,e)){s="class"===s?"className":s,update(o,s,evaluateTemplate(n,t))}}}}function renderTemplate(e,t){return e.replace(/\{\{[^\{\{]+\}\}/g,(e=>{const n=b(e).trim();return t[n]?sanitizeString(t[n]):`{{ ${n} }}`}))}function initiateSubComponents(e,t){const n=new RegExp("<[A-Z]\\w+/[>]","g"),r=new RegExp("<([A-Z]\\w+)\\s*\\{[^>]*\\}\\s*/>","g");return n.test(e)&&!t&&(e=e.replace(n,(e=>{let t,n;try{n=e.slice(1,-2);const r=Function("return "+n)();t=renderSubComponent(r,n)}catch(e){console.error("QueFlow Error:\nAn error occured while rendering subComponent '"+n+"'\n"+e)}return t}))),r.test(e)&&(e=e.replace(r,(e=>{const t=e.indexOf(" "),n=e.slice(1,t),r=e.slice(t,-2).trim();let s;try{const[e,t]=Function(`return [${n}, ${r}]`)();s=renderNugget(e,t)}catch(e){console.error("QueFlow Error:\nAn error occured while rendering Nugget '"+n+"'\n"+e)}return s}))),lintPlaceholders(e,t)}function g(e,t){const n=(new DOMParser).parseFromString(e,"text/html").body,r=n.querySelectorAll("*");for(const e of r)e.classList.add("nugget"+t);return n.innerHTML}const lintPlaceholders=(e,t)=>{const n=new RegExp("\\s\\w+\\s*[=]\\s*\\{\\{[^\\}\\}]+\\}\\}","g"),r=new RegExp("\\s(on)\\w+\\s*[=]\\s*\\{\\{[^\\}\\}]+\\}\\}","g");if(r.test(e)&&!t&&(e=e.replace(r,(e=>(e=e.replaceAll("'","`")).replace("{{","'").replace(/}}$/,"'")))),n.test(e)){return e.replace(n,(e=>e.replace("{{",'"{{').replace(/}}$/,'}}"')))}return e},removeEvents=e=>{e.forEach((e=>{const t=getAttributes(e);for(var{attribute:n,value:r}of t)if("on"===n.slice(0,2)){const t=e[n];e.removeEventListener(n,t)}}))},renderSubComponent=(e,t)=>{let n="<div>"+(e.template instanceof Function?e.template():e.template)+"</div>";n=initiateSubComponents(n);const[r,s]=getFirstElement(n);initiateStyleSheet(`#${r.id}`,e);const i=jsxToHTML(s,e,t);return r.innerHTML=i[0],e.dataQF=i[1],e.element=r,i[0]};class QComponent{constructor(e="",t={}){if(this.element="string"==typeof e?document.querySelector(e):e,!this.element)throw new Error("QueFlow Error:\nElement selector '"+e+"' is invalid");this.data=createSignal(t.data,{forComponent:!0,host:this});let n=this.data;this.options=t,this.isFrozen=!1,this.stylesheet=t.stylesheet,this.dataQF=[],this.renderEvent=qfEvent("qf:update",{key:"",value:""}),this.created=t.created,this.run=t.run,!0===t.useStrict||!1===t.useStrict?this.useStrict=t.useStrict:this.useStrict=!0;let r=this.element.id;if(!r)throw new Error("QueFlow Error:\nTo use component scoped stylesheets, component's element must have a valid id");initiateStyleSheet(`#${r}`,this),Object.defineProperties(this,{template:{value:this.options.template},data:{get:()=>n,set:e=>(isSame(e,this.data)||this.isFrozen||(n=createSignal(e,{forComponent:!0,host:this}),this.dataQF=filterNullElements(this.dataQF),this.render()),!0),configurable:!0}}),this.created&&this.created(this)}render(){let e=this.element,t=this.template instanceof Function?this.template():this.template;t=initiateSubComponents(t);let n=jsxToHTML(t,this);e.innerHTML=n[0],this.dataQF=n[1],handleEventListener(e,this),this.run&&this.run(this)}freeze(){this.isFrozen=!0}unfreeze(){this.isFrozen=!1}destroy(){const e=[this.element,...this.element.querySelectorAll("*")];removeEvents(e),this.element.remove()}}class subComponent{constructor(e,t={}){if(e&&(globalThis[e]=this),this.name=e,this.template=t?.template,!this.template)throw new Error("QueFlow Error:\nTemplate not provided for Subcomponent "+e);this.element="",this.data=createSignal(t.data,{forComponent:!0,host:this});let n=this.data;this.options=t,this.isFrozen=!1,this.elemId="",this.created=t.created,this.stylesheet=t.stylesheet,this.dataQF=[],this.renderEvent=qfEvent("qf:render"),!0===t.useStrict||!1===t.useStrict?this.useStrict=t.useStrict:this.useStrict=!0,Object.defineProperties(this,{data:{get:()=>n,set:e=>(isSame(e,this.data)||this.isFrozen||(n=createSignal(e,{forComponent:!0,host:this}),this.dataQF=filterNullElements(this.dataQF),renderSubComponent(this,this.name)),!0),configurable:!0,mutable:!1}}),this.created&&this.created(this)}freeze(){this.isFrozen=!0}unfreeze(){this.isFrozen=!1}destroy(){const e=[this.element,...this.element.querySelectorAll("*")];removeEvents(e),this.element.remove()}}class Template{constructor(e,t,n){this.element="string"==typeof e?document.querySelector(e):e,this.template=n,this.stylesheet=t;let r=this.element.id;if(!r)throw new Error("QueFlow Error:\nTo use template scoped stylesheets, template's element must have a valid id");initiateStyleSheet(`#${r}`,this)}renderWith(e,t="append"){let n=jsxToHTML(renderTemplate(this.template instanceof Function?this.template(e):this.template,e)),r=this.element,s=r.innerHTML;r.innerHTML=s+n[0]}}const renderNugget=(e,t)=>{e.stylesheetInitiated||(nuggetCounter++,e.counter=nuggetCounter);const n=e.counter,r=g(renderTemplate(initiateSubComponents(e.template instanceof Function?e.template(t):e.template,!0),t),n);return e.stylesheetInitiated||(initiateStyleSheet("."+("nugget"+n),e,!0),e.stylesheetInitiated=!0),r};class Nugget{constructor(e,t={}){e&&(globalThis[e]=this),this.stylesheet=t.stylesheet??{},this.className=`qfEl${counterQF}`,counterQF++,this.template=t.template,this.stylesheetInitiated=!1,this.counter=0}}export{QComponent,subComponent,Nugget,Template};
//# sourceMappingURL=/sm/26e7985de3d223fde3e388e70063952bece8545d1a4d3d29b10aec79f524f5bb.map